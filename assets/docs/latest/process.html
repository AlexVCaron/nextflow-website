

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Processes &mdash; Nextflow 0.14.4 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'./',
        VERSION:'0.14.4',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
    <script type="text/javascript">
        jQuery(function () {
            SphinxRtdTheme.StickyNav.enable();
        });
    </script>
  

  
    <link rel="top" title="Nextflow 0.14.4 documentation" href="index.html"/>
        <link rel="next" title="Channels" href="channel.html"/>
        <link rel="prev" title="Pipeline script" href="script.html"/> 

  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="index.html" class="fa fa-home"> Nextflow</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getstarted.html">Get started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getstarted.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="getstarted.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="getstarted.html#your-first-script">Your first script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="basic.html">Basic concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="basic.html#processes-and-channels">Processes and channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic.html#execution-abstraction">Execution abstraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic.html#scripting-language">Scripting language</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic.html#configuration-options">Configuration options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="script.html">Pipeline script</a><ul>
<li class="toctree-l2"><a class="reference internal" href="script.html#language-basics">Language basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="script.html#closures">Closures</a></li>
<li class="toctree-l2"><a class="reference internal" href="script.html#regular-expressions">Regular expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="script.html#files-and-i-o">Files and I/O</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Processes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#script">Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="#inputs">Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#outputs">Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#when">When</a></li>
<li class="toctree-l2"><a class="reference internal" href="#shares">Shares</a></li>
<li class="toctree-l2"><a class="reference internal" href="#directives">Directives</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="channel.html">Channels</a><ul>
<li class="toctree-l2"><a class="reference internal" href="channel.html#channel-factory">Channel factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="channel.html#binding-values">Binding values</a></li>
<li class="toctree-l2"><a class="reference internal" href="channel.html#observing-events">Observing events</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="operator.html">Operators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="operator.html#filtering-operators">Filtering operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="operator.html#transforming-operators">Transforming operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="operator.html#splitting-operators">Splitting operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="operator.html#combining-operators">Combining operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="operator.html#forking-operators">Forking operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="operator.html#maths-operators">Maths operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="operator.html#other-operators">Other operators</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="executor.html">Executors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="executor.html#local-executor">Local executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="executor.html#sge-executor">SGE executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="executor.html#lsf-executor">LSF executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="executor.html#slurm-executor">SLURM executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="executor.html#pbs-torque-executor">PBS/Torque executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="executor.html#drmaa-executor">DRMAA executor</a></li>
<li class="toctree-l2"><a class="reference internal" href="executor.html#clusterk-cirrus">ClusterK Cirrus</a></li>
<li class="toctree-l2"><a class="reference internal" href="executor.html#dnanexus">DNAnexus</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="config.html#configuration-file">Configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#config-scopes">Config scopes</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#config-profiles">Config profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html#environment-variables">Environment variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="amazons3.html">Amazon S3 storage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="amazons3.html#s3-path">S3 path</a></li>
<li class="toctree-l2"><a class="reference internal" href="amazons3.html#security-credentials">Security credentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="amazons3.html#advanced-configuration">Advanced configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docker.html">Docker containers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="docker.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker.html#how-it-works">How it works</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker.html#multiple-containers">Multiple containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker.html#executable-containers">Executable containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="docker.html#advanced-settings">Advanced settings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dnanexus.html">DNAnexus cloud</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dnanexus.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="dnanexus.html#app-packing">App packing</a></li>
<li class="toctree-l2"><a class="reference internal" href="dnanexus.html#execution">Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="dnanexus.html#how-it-works">How it works</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gridgain.html">GridGain cluster</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gridgain.html#cluster-daemon">Cluster daemon</a></li>
<li class="toctree-l2"><a class="reference internal" href="gridgain.html#pipeline-execution">Pipeline execution</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tracing.html">Performance Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tracing.html#execution-report">Execution report</a></li>
<li class="toctree-l2"><a class="reference internal" href="tracing.html#extrae-integration">Extrae integration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sharing.html">Pipeline sharing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sharing.html#how-it-works">How it works</a></li>
<li class="toctree-l2"><a class="reference internal" href="sharing.html#run-a-pipeline">Run a pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="sharing.html#handle-revisions">Handle revisions</a></li>
<li class="toctree-l2"><a class="reference internal" href="sharing.html#commands-to-manage-pipelines">Commands to manage pipelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="sharing.html#publish-your-pipeline">Publish your pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="sharing.html#manage-dependencies">Manage dependencies</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example.html">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="example.html#basic-pipeline">Basic pipeline</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Nextflow</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Processes</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="processes">
<span id="process-page"></span><h1>Processes<a class="headerlink" href="#processes" title="Permalink to this headline">¶</a></h1>
<p>In Nextflow a <cite>process</cite> is the basic processing <cite>primitive</cite> to execute a user script.</p>
<p>The process definition starts with keyword the <tt class="docutils literal"><span class="pre">process</span></tt>, followed by process name and finally the process <cite>body</cite>
delimited by curly brackets. The process body must contain a string which represents the command or, more generally,
a script that is executed by it. A basic process looks like the following example:</p>
<div class="highlight-python"><pre>process sayHello {

    """
    echo 'Hello world!' &gt; file
    """

}</pre>
</div>
<p>more specifically a process may contain five definition blocks, respectively: directives,
inputs, outputs, shares and finally the process script. The syntax is defined as follows:</p>
<div class="highlight-python"><pre>process &lt; name &gt; {

   [ directives ]

   input:
    &lt; process inputs &gt;

   output:
    &lt; process outputs &gt;

   when:
    &lt; condition &gt;

   [script|shell|exec]:
   &lt; user script to be executed &gt;

}</pre>
</div>
<div class="section" id="script">
<span id="process-script"></span><h2>Script<a class="headerlink" href="#script" title="Permalink to this headline">¶</a></h2>
<p>The <cite>script</cite> block is a string statement that defines the command that is executed by the process to carry out its task.</p>
<p>A process contains one and only one script block, and it must be the last statement when the process contains
input, output and share declarations.</p>
<p>The entered string is executed as a <a class="reference external" href="http://en.wikipedia.org/wiki/Bash_(Unix_shell)">BASH</a> script in the
<cite>host</cite> system. It can be any command, script or combination of them, that you would normally use in terminal shell
or in a common BASH script.</p>
<p>The only limitation to the commands that can be used in the script statement is given by the availability of those
programs in the target execution system.</p>
<p>The script block can be a simple string or multi-line string. The latter simplifies the writing of non trivial scripts
composed by multiple commands spanning over multiple lines. For example:</p>
<div class="highlight-python"><pre>process doMoreThings {

  """
  blastp -db $db -query query.fa -outfmt 6 &gt; blast_result
  cat blast_result | head -n 10 | cut -f 2 &gt; top_hits
  blastdbcmd -db $db -entry_batch top_hits &gt; sequences
  """

}</pre>
</div>
<p>As explained in the script tutorial section, strings can be defined by using a single-quote
or a double-quote, and multi-line strings are defined by three single-quote or three double-quote characters.</p>
<p>There is a subtle but important difference between them. Like in BASH, strings delimited by a <tt class="docutils literal"><span class="pre">&quot;</span></tt> character support
variable substitutions, while strings delimited by <tt class="docutils literal"><span class="pre">'</span></tt> do not.</p>
<p>In the above code fragment the <tt class="docutils literal"><span class="pre">$db</span></tt> variable is replaced by the actual value defined somewhere in the
pipeline script.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Since Nextflow uses the same BASH syntax for variable substitutions in strings, you need to manage them
carefully depending on if you want to evaluate a variable in the Nextflow context - or - in the BASH environment execution.</p>
</div>
<p>When you need to access a system environment variable  in your script you have two options. The first choice is as
easy as defining your script block by using a single-quote string. For example:</p>
<div class="highlight-python"><pre>process printPath {

   '''
   echo The path is: $PATH
   '''

}</pre>
</div>
<p>The drawback of this solution is that you will not able to access variables defined in the pipeline script context,
in your script block.</p>
<p>To fix this, define your script by using a double-quote string and <cite>escape</cite> the system environment variables by
prefixing them with a back-slash <tt class="docutils literal"><span class="pre">\</span></tt> character, as shown in the following example:</p>
<div class="highlight-python"><pre>process doOtherThings {

  """
  blastp -db \$DB -query query.fa -outfmt 6 &gt; blast_result
  cat blast_result | head -n $MAX | cut -f 2 &gt; top_hits
  blastdbcmd -db \$DB -entry_batch top_hits &gt; sequences
  """

}</pre>
</div>
<p>In this example the <tt class="docutils literal"><span class="pre">$MAX</span></tt> variable has to be defined somewhere before, in the pipeline script.
<cite>Nextflow</cite> replaces it with the actual value before executing the script. Instead, the <tt class="docutils literal"><span class="pre">$DB</span></tt> variable
must exist in the script execution environment and the BASH interpreter will replace it with the actual value.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Alternatively you can use the <a class="reference internal" href="#process-shell"><em>Shell</em></a> block definition which allows a script to contain both
BASH and Nextflow variables without having to escape the first.</p>
</div>
<div class="section" id="scripts-a-la-carte">
<h3>Scripts <cite>à la carte</cite><a class="headerlink" href="#scripts-a-la-carte" title="Permalink to this headline">¶</a></h3>
<p>The process script is interpreted by Nextflow as a BASH script by default, but you are not limited to it.</p>
<p>You can use your favourite scripting language (e.g. Perl, Python, Ruby, R, etc), or even mix them in the same pipeline.</p>
<p>A pipeline may be composed by processes that execute very different tasks. Using <cite>Nextflow</cite> you can choose the scripting
language that better fits the task carried out by a specified process. For example for some processes <cite>R</cite> could be
more useful than <cite>Perl</cite>, in other you may need to use <cite>Python</cite> because it provides better access to a library or an API, etc.</p>
<p>To use a scripting other than BASH, simply start your process script with the corresponding
<a class="reference external" href="http://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a> declaration. For example:</p>
<div class="highlight-python"><pre>process perlStuff {

    """
    #!/usr/bin/perl

    print 'Hi there!' . '\n';
    """

}

process pyStuff {

    """
    #!/usr/bin/python

    x = 'Hello'
    y = 'world!'
    print "%s - %s" % (x,y)
    """

}</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Since the actual location of the interpreter binary file can change across platforms, to make your scripts
more portable it is wise to use the <tt class="docutils literal"><span class="pre">env</span></tt> shell command followed by the interpreter's name, instead of the absolute
path of it. Thus, the <cite>shebang</cite> declaration for a Perl script, for example,
would look like: <tt class="docutils literal"><span class="pre">#!/usr/bin/env</span> <span class="pre">perl</span></tt> instead of the one in the above pipeline fragment.</p>
</div>
</div>
<div class="section" id="conditional-scripts">
<h3>Conditional scripts<a class="headerlink" href="#conditional-scripts" title="Permalink to this headline">¶</a></h3>
<p>Complex process scripts may need to evaluate conditions on the input parameters or use traditional flow control
statements (i.e. <tt class="docutils literal"><span class="pre">if</span></tt>, <tt class="docutils literal"><span class="pre">switch</span></tt>, etc) in order to execute specific script commands, depending on the current
inputs configuration.</p>
<p>Process scripts can contain conditional statements by simply prefixing the script block with the keyword <tt class="docutils literal"><span class="pre">script:</span></tt>.
By doing that the interpreter will evaluate all the following statements as a code block that must return the
script string to be executed. It's much easier to use than to explain, for example:</p>
<div class="highlight-python"><pre>seq_to_align = ...
mode = 'tcoffee'

process align {
    input:
    file seq_to_aln from sequences

    script:
    if( mode == 'tcoffee' )
        """
        t_coffee -in $seq_to_aln &gt; out_file
        """

    else if( mode == 'mafft' )
        """
        mafft --anysymbol --parttree --quiet $seq_to_aln &gt; out_file
        """

    else if( mode == 'clustalo' )
        """
        clustalo -i $seq_to_aln -o out_file
        """

    else
        error "Invalid alignment mode: ${mode}"

}</pre>
</div>
<p>In the above example the process will execute the script fragment depending on the value of the <tt class="docutils literal"><span class="pre">mode</span></tt> parameter.
By default it will execute the <tt class="docutils literal"><span class="pre">tcoffee</span></tt> command, changing the <tt class="docutils literal"><span class="pre">mode</span></tt> variable to <tt class="docutils literal"><span class="pre">mafft</span></tt> or <tt class="docutils literal"><span class="pre">clustalo</span></tt> value,
the other branches will be executed.</p>
</div>
<div class="section" id="template">
<span id="process-template"></span><h3>Template<a class="headerlink" href="#template" title="Permalink to this headline">¶</a></h3>
<p>Process script can be externalised by using <em>template</em> files which can be reused across different processes and tested
independently by the overall pipeline execution.</p>
<p>A template is simply a shell script file that Nextflow is able to execute by using the <tt class="docutils literal"><span class="pre">template</span></tt> function
as shown below:</p>
<div class="highlight-python"><pre>process template_example {

    input:
    val STR from 'this', 'that'

    script:
    template 'my_script.sh'

}</pre>
</div>
<p>Nextflow looks for the <tt class="docutils literal"><span class="pre">my_script.sh</span></tt> template file in the directory <tt class="docutils literal"><span class="pre">templates</span></tt> that must exist in the same folder
where the Nextflow script file is located (any other location can be provided by using an absolute template path).</p>
<p>The template script can contain any piece of code that can be executed by the underlying system. For example:</p>
<div class="highlight-python"><pre>#!/bin/bash
echo "process started at `date`"
echo $STR
:
echo "process completed"</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Note that the dollar character (<tt class="docutils literal"><span class="pre">$</span></tt>) is interpreted as a Nextflow variable placeholder, when the script is run as a
Nextflow template, while it is evaluated as a BASH variable when it is run alone. This can be very useful to test
your script autonomously, i.e. independently from Nextflow execution. You only need to provide a BASH environment
variable for each the Nextflow variable existing in your script. For example, it would be possible to execute the above
script entering the following command in the shell terminal: <tt class="docutils literal"><span class="pre">STR='foo'</span> <span class="pre">bash</span> <span class="pre">templates/my_script.sh</span></tt></p>
</div>
</div>
<div class="section" id="shell">
<span id="process-shell"></span><h3>Shell<a class="headerlink" href="#shell" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is an incubating feature. It may change in future Nextflow releases.</p>
</div>
<p>The <tt class="docutils literal"><span class="pre">shell</span></tt> block is a string statement that defines the <em>shell</em> command executed by the process to carry out its task.
It is an alternative to the <a class="reference internal" href="#process-script"><em>Script</em></a> definition with an important difference, it uses
the exclamation mark <tt class="docutils literal"><span class="pre">!</span></tt> character as the variable placeholder for Nextflow variables in place of the usual dollar character.</p>
<p>In this way it is possible to use both Nextflow and BASH variables in the same piece of code without having to escape
the latter and making process scripts more readable and easy to maintain. For example:</p>
<div class="highlight-python"><pre>process myTask {

    input:
    val str from 'Hello', 'Hola', 'Bonjour'

    shell:
    '''
    echo User $USER says !{str}
    '''

}</pre>
</div>
<p>In the above trivial example the <tt class="docutils literal"><span class="pre">$USER</span></tt> variable is managed by the BASH interpreter, while <tt class="docutils literal"><span class="pre">!{str}</span></tt> is handled
as a process input variable managed by Nextflow.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Shell script definition requires the use of single-quote <tt class="docutils literal"><span class="pre">'</span></tt> delimited strings. When using double-quote <tt class="docutils literal"><span class="pre">&quot;</span></tt>
delimited strings, dollar variables are interpreted as Nextflow variables as usual. See <a class="reference internal" href="script.html#string-interpolation"><em>String interpolation</em></a>.</li>
<li>Exclamation mark prefixed variables always need to be enclosed in curly brackets i.e. <tt class="docutils literal"><span class="pre">!{str}</span></tt> is a valid
variable while <tt class="docutils literal"><span class="pre">!str</span></tt> is ignored.</li>
<li>Shell script supports the use of the file <a class="reference internal" href="#process-template"><em>Template</em></a> mechanism. The same rules are applied to the variables
defined in the script template.</li>
</ul>
</div>
</div>
<div class="section" id="native-execution">
<span id="process-native"></span><h3>Native execution<a class="headerlink" href="#native-execution" title="Permalink to this headline">¶</a></h3>
<p>Nextflow processes can execute native code other than system scripts as shown in the previous paragraphs.</p>
<p>This means that instead of specifying the process command to be executed as a string script, you can
define it by providing one or more language statements, as you would do in the rest of the pipeline script.
Simply starting the script definition block with the <tt class="docutils literal"><span class="pre">exec:</span></tt> keyword, for example:</p>
<div class="highlight-python"><pre>x = Channel.from( 'a', 'b', 'c')

process simpleSum {
    input:
    val x

    exec:
    println "Hello Mr. $x"
}</pre>
</div>
<p>Will display:</p>
<div class="highlight-python"><pre>Hello Mr. b
Hello Mr. a
Hello Mr. c</pre>
</div>
</div>
</div>
<div class="section" id="inputs">
<span id="process-input"></span><h2>Inputs<a class="headerlink" href="#inputs" title="Permalink to this headline">¶</a></h2>
<p>Nextflow processes are isolated from each other but can communicate between themselves sending values through channels.</p>
<p>The <cite>input</cite> block defines which channels the process is expecting to receive inputs data from. You can only define one
input block at a time and it must contain one or more inputs declarations.</p>
<p>The input block follows the syntax shown below:</p>
<div class="highlight-python"><pre>input:
  &lt;input qualifier&gt; &lt;input name&gt; [from &lt;source channel&gt;] [attributes]</pre>
</div>
<p>An input definition starts with an input <cite>qualifier</cite> and the input <cite>name</cite>, followed by the keyword <tt class="docutils literal"><span class="pre">from</span></tt> and
the actual channel over which inputs are received. Finally some input optional attributes can be specified.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When the input name is the same as the channel name, the <tt class="docutils literal"><span class="pre">from</span></tt> part of the declaration can be omitted.</p>
</div>
<p>The input qualifier declares the <cite>type</cite> of data to be received. This information is used by Nextflow to apply the
semantic rules associated to each qualifier and handle it properly depending on the target execution platform
(grid, cloud, etc).</p>
<p>The qualifiers available are the ones listed in the following table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Qualifier</th>
<th class="head">Semantic</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>val</td>
<td>Lets you access the received input value by its name in the process script.</td>
</tr>
<tr class="row-odd"><td>env</td>
<td>Lets you use the received value to set an environment variable named
as the specified input name.</td>
</tr>
<tr class="row-even"><td>file</td>
<td>Lets you handle the received value as a file, staging it properly in the execution context.</td>
</tr>
<tr class="row-odd"><td>stdin</td>
<td>Lets you forward the received value to the process <cite>stdin</cite> special file.</td>
</tr>
<tr class="row-even"><td>set</td>
<td>Lets you handle a group of input values having one of the above qualifiers.</td>
</tr>
<tr class="row-odd"><td>each</td>
<td>Lets you execute the process for each entry in the input collection.</td>
</tr>
</tbody>
</table>
<div class="section" id="input-of-generic-values">
<h3>Input of generic values<a class="headerlink" href="#input-of-generic-values" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">val</span></tt> qualifier allows you to receive data of any type as input. It can be accessed in the process script
by using the specified input name, as shown in the following example:</p>
<div class="highlight-python"><pre>num = Channel.from( 1, 2, 3 )

process basicExample {
  input:
  val x from num

  "echo process job $x"

}</pre>
</div>
<p>In the above example the process is executed three times, each time a value is received from the channel <tt class="docutils literal"><span class="pre">num</span></tt>
and used to process the script. Thus, it results in an output similar to the one shown below:</p>
<div class="highlight-python"><pre>process job 3
process job 1
process job 2</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <cite>channel</cite> guarantees that items are delivered in the same order as they have been sent - but -
since the process is executed in a parallel manner, there is no guarantee that they are processed in the
same order as they are received. In fact, in the above example, value <tt class="docutils literal"><span class="pre">3</span></tt> is processed before the others.</p>
</div>
<p>When the <tt class="docutils literal"><span class="pre">val</span></tt> has the same name as the channel from where the data is received, the <tt class="docutils literal"><span class="pre">from</span></tt> part can be omitted.
Thus the above example can be written as shown below:</p>
<div class="highlight-python"><pre>num = Channel.from( 1, 2, 3 )

process basicExample {
  input:
  val num

  "echo process job $num"

}</pre>
</div>
</div>
<div class="section" id="input-of-files">
<h3>Input of files<a class="headerlink" href="#input-of-files" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">file</span></tt> qualifier allows you to receive a value as a file in the process execution context. This means that
Nextflow will stage it in the process execution directory, and you can access it in the script by using the name
specified in the input declaration. For example:</p>
<div class="highlight-python"><pre>proteins = Channel.fromPath( '/some/path/*.fa' )

process blastThemAll {
  input:
  file query_file from proteins

  "blastp -query ${query_file} -db nr"

}</pre>
</div>
<p>In the above example all the files ending with the suffix <tt class="docutils literal"><span class="pre">.fa</span></tt> are sent over the channel <tt class="docutils literal"><span class="pre">proteins</span></tt>.
Then, these files are received by the process which will execute a <cite>BLAST</cite> query on each of them.</p>
<p>When the file input name is the same as the channel name, the <tt class="docutils literal"><span class="pre">from</span></tt> part of the input declaration can be omitted.
Thus, the above example could be written as shown below:</p>
<div class="highlight-python"><pre>proteins = Channel.fromPath( '/some/path/*.fa' )

process blastThemAll {
  input:
  file proteins

  "blastp -query $proteins -db nr"

}</pre>
</div>
<p>It's worth noting that in the above examples, the name of the file in the file-system is not touched, you can
access the file even without knowing its name because you can reference it in the process script by using the
variable whose name is specified in the input file parameter declaration.</p>
<p>There may be cases where your task needs to use a file whose name is fixed, it does not have to change along
with the actual provided file. In this case you can specify its name by specifying the <tt class="docutils literal"><span class="pre">name</span></tt> attribute in the
input file parameter declaration, as shown in the following example:</p>
<div class="highlight-python"><pre>input:
    file query_file name 'query.fa' from proteins</pre>
</div>
<p>Or alternatively using a shorter syntax:</p>
<div class="highlight-python"><pre>input:
    file 'query.fa' from proteins</pre>
</div>
<p>Using this, the previous example can be re-written as shown below:</p>
<div class="highlight-python"><pre>proteins = Channel.fromPath( '/some/path/*.fa' )

process blastThemAll {
  input:
  file 'query.fa' from proteins

  "blastp -query query.fa -db nr"

}</pre>
</div>
<p>What happens in this example is that each file, that the process receives, is staged with the name <tt class="docutils literal"><span class="pre">query.fa</span></tt>
in a different execution context (i.e. the folder where the job is executed) and an independent process
execution is launched.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">This allows you to execute the process command various time without worrying the files names changing.
In other words, <cite>Nextflow</cite> helps you write pipeline tasks that are self-contained and decoupled by the execution
environment. This is also the reason why you should avoid whenever possible to use absolute or relative paths
referencing files in your pipeline processes.</p>
</div>
</div>
<div class="section" id="multiple-input-files">
<h3>Multiple input files<a class="headerlink" href="#multiple-input-files" title="Permalink to this headline">¶</a></h3>
<p>A process can declare as input file a channel that emits a collection of values, instead of a simple value.</p>
<p>In this case, the script variable defined by the input file parameter will hold a list of files. You can
use it as shown before, referring to all the files in the list, or by accessing a specific entry using the
usual square brackets notation.</p>
<p>When a target file name is defined in the input parameter and a collection of files is received by the process,
the file name will be appended by a numerical suffix representing its ordinal position in the list. For example:</p>
<div class="highlight-python"><pre>fasta = Channel.fromPath( "/some/path/*.fa" ).buffer(count:3)

process blastThemAll {
    input:
    file 'seq' from fasta

    "echo seq*"

}</pre>
</div>
<p>Will output:</p>
<div class="highlight-python"><pre>seq1 seq2 seq3
seq1 seq2 seq3
...</pre>
</div>
<p>The target input file name can contain the <tt class="docutils literal"><span class="pre">*</span></tt> and <tt class="docutils literal"><span class="pre">?</span></tt> wildcards, that can be used
to control the name of staged files. The following table shows how the wildcards are
replaced depending on the cardinality of the received input collection.</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="18%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Cardinality</th>
<th class="head">Name pattern</th>
<th class="head">Staged file names</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td><tt class="docutils literal"><span class="pre">file*.ext</span></tt></td>
<td><tt class="docutils literal"><span class="pre">file.ext</span></tt></td>
</tr>
<tr class="row-odd"><td>1</td>
<td><tt class="docutils literal"><span class="pre">file?.ext</span></tt></td>
<td><tt class="docutils literal"><span class="pre">file1.ext</span></tt></td>
</tr>
<tr class="row-even"><td>1</td>
<td><tt class="docutils literal"><span class="pre">file??.ext</span></tt></td>
<td><tt class="docutils literal"><span class="pre">file01.ext</span></tt></td>
</tr>
<tr class="row-odd"><td>many</td>
<td><tt class="docutils literal"><span class="pre">file*.ext</span></tt></td>
<td><tt class="docutils literal"><span class="pre">file1.ext</span></tt>, <tt class="docutils literal"><span class="pre">file2.ext</span></tt>, <tt class="docutils literal"><span class="pre">file3.ext</span></tt>, ..</td>
</tr>
<tr class="row-even"><td>many</td>
<td><tt class="docutils literal"><span class="pre">file?.ext</span></tt></td>
<td><tt class="docutils literal"><span class="pre">file1.ext</span></tt>, <tt class="docutils literal"><span class="pre">file2.ext</span></tt>, <tt class="docutils literal"><span class="pre">file3.ext</span></tt>, ..</td>
</tr>
<tr class="row-odd"><td>many</td>
<td><tt class="docutils literal"><span class="pre">file??.ext</span></tt></td>
<td><tt class="docutils literal"><span class="pre">file01.ext</span></tt>, <tt class="docutils literal"><span class="pre">file02.ext</span></tt>, <tt class="docutils literal"><span class="pre">file03.ext</span></tt>, ..</td>
</tr>
</tbody>
</table>
<p>The following fragment shows how a wildcard can be used in the input file declaration:</p>
<div class="highlight-python"><pre>fasta = Channel.fromPath( "/some/path/*.fa" ).buffer(count:3)

process blastThemAll {
    input:
    file 'seq?.fa' from fasta

    "cat seq1.fa seq2.fa seq3.fa"

}</pre>
</div>
</div>
<div class="section" id="dynamic-input-file-names">
<h3>Dynamic input file names<a class="headerlink" href="#dynamic-input-file-names" title="Permalink to this headline">¶</a></h3>
<p>When the input file name is specified by using the <tt class="docutils literal"><span class="pre">name</span></tt> file clause or the short <cite>string</cite> notation, you
are allowed to use other input values as variables in the file name string. For example:</p>
<div class="highlight-python"><pre>process simpleCount {
  input:
  val x from species
  file "${x}.fa" from genomes

  """
  cat ${x}.fa | grep '&gt;'
  """
}</pre>
</div>
<p>In the above example, the input file name is set by using the current value of the <tt class="docutils literal"><span class="pre">x</span></tt> input value.</p>
<p>This allows the input files to be staged in the script working directory with a name that is coherent
with the current execution context.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">In most cases, you won't need to use dynamic file names, because each process is executed in its
own private temporary directory, and input files are automatically staged to this directory by Nextflow.
This guarantees that input files with the same name won't overwrite each other.</p>
</div>
</div>
<div class="section" id="input-of-type-stdin">
<h3>Input of type 'stdin'<a class="headerlink" href="#input-of-type-stdin" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">stdin</span></tt> input qualifier allows you the forwarding of the value received from a channel to the
<a class="reference external" href="http://en.wikipedia.org/wiki/Standard_streams#Standard_input_.28stdin.29">standard input</a>
of the command executed by the process. For example:</p>
<div class="highlight-python"><pre>str = Channel.from('hello', 'hola', 'bonjour', 'ciao').map { it+'\n' }

process printAll {
   input:
   stdin str

   """
   cat -
   """

}</pre>
</div>
<p>It will output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">hola</span>
<span class="n">bonjour</span>
<span class="n">ciao</span>
<span class="n">hello</span>
</pre></div>
</div>
</div>
<div class="section" id="input-of-type-env">
<h3>Input of type 'env'<a class="headerlink" href="#input-of-type-env" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">env</span></tt> qualifier allows you to define an environment variable in the process execution context based
on the value received from the channel. For example:</p>
<div class="highlight-python"><pre>str = Channel.from('hello', 'hola', 'bonjour', 'ciao')

process printEnv {

    input:
    env HELLO from str

    '''
    echo $HELLO world!
    '''

}</pre>
</div>
<div class="highlight-python"><pre>hello world!
ciao world!
bonjour world!
hola world!</pre>
</div>
</div>
<div class="section" id="input-of-type-set">
<h3>Input of type 'set'<a class="headerlink" href="#input-of-type-set" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">set</span></tt> qualifier allows you to group multiple parameters in a single parameter definition. It can be useful
when a process receives, in input, tuples of values that need to be handled separately. Each element in the tuple
is associated to a corresponding element with the <tt class="docutils literal"><span class="pre">set</span></tt> definition. For example:</p>
<div class="highlight-python"><pre>tuple = Channel.from( [1, 'alpha'], [2, 'beta'], [3, 'delta'] )

process setExample {
    input:
    set val(x), file('latin.txt')  from tuple

    """
    echo Processing $x
    cat - latin.txt &gt; copy
    """

}</pre>
</div>
<p>In the above example the <tt class="docutils literal"><span class="pre">set</span></tt> parameter is used to define the value <tt class="docutils literal"><span class="pre">x</span></tt> and the file <tt class="docutils literal"><span class="pre">latin.txt</span></tt>,
which will receive a value from the same channel.</p>
<p>In the <tt class="docutils literal"><span class="pre">set</span></tt> declaration items can be defined by using the following qualifiers: <tt class="docutils literal"><span class="pre">val</span></tt>, <tt class="docutils literal"><span class="pre">env</span></tt>, <tt class="docutils literal"><span class="pre">file</span></tt> and <tt class="docutils literal"><span class="pre">stdin</span></tt>.</p>
<p>A shorter notation can be used by applying the following substitution rules:</p>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">long</th>
<th class="head">short</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>val(x)</td>
<td>x</td>
</tr>
<tr class="row-odd"><td>file(x)</td>
<td>(not supported)</td>
</tr>
<tr class="row-even"><td>file('name')</td>
<td>'name'</td>
</tr>
<tr class="row-odd"><td>file(x:'name')</td>
<td>x:'name'</td>
</tr>
<tr class="row-even"><td>stdin</td>
<td>'-'</td>
</tr>
<tr class="row-odd"><td>env(x)</td>
<td>(not supported)</td>
</tr>
</tbody>
</table>
<p>Thus the previous example could be rewritten as follows:</p>
<div class="highlight-python"><pre>tuple = Channel.from( [1, 'alpha'], [2, 'beta'], [3, 'delta'] )

process setExample {
    input:
    set x, 'latin.txt' from tuple

    """
    echo Processing $x
    cat - latin.txt &gt; copy
    """

}</pre>
</div>
<p>File names can be defined in <em>dynamic</em> manner as explained in the <a class="reference internal" href="#dynamic-input-file-names">Dynamic input file names</a> section.</p>
</div>
<div class="section" id="input-repeaters">
<h3>Input repeaters<a class="headerlink" href="#input-repeaters" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">each</span></tt> qualifier allows you to repeat the execution of a process for each item in a collection,
every time new data is received. For example:</p>
<div class="highlight-python"><pre>sequences = Channel.fromPath('*.fa')
methods = ['regular', 'expresso', 'psicoffee']

process alignSequences {
  input:
  file seq from sequences
  each mode from methods

  """
  t_coffee -in $seq -mode $mode &gt; result
  """

}</pre>
</div>
<p>In the above example every time a file of sequences is received as input by the process,
it executes three T-coffee tasks, using a different value for the <tt class="docutils literal"><span class="pre">mode</span></tt> parameter.</p>
<p>This is useful when you need to <cite>repeat</cite> the same task for a given set of parameters.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When multiple repeaters are declared, the process is executed for each <em>combination</em> them.</p>
</div>
<p>Take in consideration the following example. The process declares, in input, a channel receiving a
generic <tt class="docutils literal"><span class="pre">shape</span></tt> of values. Each time a new shape value is received, it <cite>draws</cite> it
in two different colors and three different sizes:</p>
<div class="highlight-python"><pre>shapes = Channel.from('circle','square', 'triangle' .. )

process combine {
  input:
  val shape from shapes
  each color from 'red','blue'
  each size from 1,2

  "echo draw $shape $color with size: $size"

}</pre>
</div>
<p>Will output:</p>
<div class="highlight-python"><pre>draw circle red with size: 1
draw circle red with size: 2
draw circle red with size: 3
draw circle blue with size: 1
draw circle blue with size: 2
draw circle blue with size: 3
draw square red with size: 1
draw square red with size: 2
draw square red with size: 3
draw square blue with size: 1
draw square blue with size: 2
draw square blue with size: 3
draw triangle red with size: 1
draw triangle red with size: 2
draw triangle red with size: 3
draw triangle blue with size: 1
draw triangle blue with size: 2
draw triangle blue with size: 3
..</pre>
</div>
</div>
</div>
<div class="section" id="outputs">
<h2>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h2>
<p>The <cite>output</cite> declaration block allows to define the channels used by the process to send out the results produced.</p>
<p>It can be defined at most one output block and it can contain one or more outputs declarations.
The output block follows the syntax shown below:</p>
<div class="highlight-python"><pre>output:
  &lt;output qualifier&gt; &lt;output name&gt; [into &lt;target channel&gt;] [attribute [,..]]</pre>
</div>
<p>Output definitions start by an output <cite>qualifier</cite> and the output <cite>name</cite>, followed by the keyword <tt class="docutils literal"><span class="pre">into</span></tt> and
the actual channel over which outputs are sent. Finally some optional attributes can be specified.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When the output name is the same as the channel name, the <tt class="docutils literal"><span class="pre">into</span></tt> part of the declaration can be omitted.</p>
</div>
<p>The qualifiers that can be used in the output declaration block are the ones listed in the following table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Qualifier</th>
<th class="head">Semantic</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>val</td>
<td>Sends variable's with the name specified over the output channel.</td>
</tr>
<tr class="row-odd"><td>file</td>
<td>Sends a file produced by the process with the name specified over the output channel.</td>
</tr>
<tr class="row-even"><td>stdout</td>
<td>Sends the executed process <cite>stdout</cite> over the output channel.</td>
</tr>
<tr class="row-odd"><td>set</td>
<td>Lets to send multiple values over the same output channel.</td>
</tr>
</tbody>
</table>
<div class="section" id="output-values">
<h3>Output values<a class="headerlink" href="#output-values" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">val</span></tt> qualifier allows to output a <cite>value</cite> defined in the script context. In a common usage scenario,
this is a value which has been defined in the <cite>input</cite> declaration block, as shown in the following example:</p>
<div class="highlight-python"><pre>methods = ['prot','dna', 'rna']

process anyValue {
  input:
  val x from methods

  output:
  val x into receiver

  """
  echo $x &gt; file
  """

}

receiver.subscribe { println "Received: $it" }</pre>
</div>
<p>The example that follows is almost identical to the previous one, but it shows how to output a value
that is computed in the script block:</p>
<div class="highlight-python"><pre>methods = ['prot','dna', 'rna']

process anyValue {
  input:
  val x from methods

  output:
  val str into receiver

  script:
  str = "Processing $x"
  """
  echo $x &gt; file
  """

}

receiver.subscribe { println "Received: $it" }</pre>
</div>
</div>
<div class="section" id="output-files">
<h3>Output files<a class="headerlink" href="#output-files" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">file</span></tt> qualifier allows to output one or more files, produced by the process, over the specified channel.
For example:</p>
<div class="highlight-python"><pre>process randomNum {

   output:
   file 'result.txt' into numbers

   '''
   echo $RANDOM &gt; result.txt
   '''

}

numbers.subscribe { println "Received: " + it.text }</pre>
</div>
<p>In the above example the process, when executed, creates a file named <tt class="docutils literal"><span class="pre">result.txt</span></tt> containing a random number.
Since a file parameter using the same name is declared between the outputs, when the task is completed that
file is sent over the <tt class="docutils literal"><span class="pre">numbers</span></tt> channel. A downstream <cite>process</cite> declaring the same channel as <cite>input</cite> will
be able to receive it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the channel specified as output has not been previously declared in the pipeline script, it
will implicitly created by the output declaration itself.</p>
</div>
</div>
<div class="section" id="multiple-output-files">
<h3>Multiple output files<a class="headerlink" href="#multiple-output-files" title="Permalink to this headline">¶</a></h3>
<p>When an output file name contains a <tt class="docutils literal"><span class="pre">*</span></tt> or <tt class="docutils literal"><span class="pre">?</span></tt> wildcard character it is interpreted as a <a class="reference external" href="http://docs.oracle.com/javase/tutorial/essential/io/fileOps.html#glob">glob</a> path matcher.
This allows to <em>capture</em> multiple files into a list object and output them as a sole emission. For example:</p>
<div class="highlight-python"><pre>process splitLetters {

    output:
    file 'chunk_*' into letters

    '''
    printf 'Hola' | split -b 1 - chunk_
    '''
}

letters
    .flatMap()
    .subscribe { println "File: ${it.name} =&gt; ${it.text}" }</pre>
</div>
<p>It prints:</p>
<div class="highlight-python"><pre>File: chunk_aa =&gt; H
File: chunk_ab =&gt; o
File: chunk_ac =&gt; l
File: chunk_ad =&gt; a</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the above example the operator <a class="reference internal" href="operator.html#operator-flatmap"><em>flatMap</em></a> is used to transform the list of files emitted by
the <tt class="docutils literal"><span class="pre">letters</span></tt> channel into a channel that emits each file object independently.</p>
</div>
<p>Some caveats on glob pattern behavior:</p>
<ul class="simple">
<li>Input files are not included in the list of possible matches.</li>
<li>Glob pattern matches against both files and directories path.</li>
<li>When a two stars pattern <tt class="docutils literal"><span class="pre">**</span></tt> is used to recurse across directories, only file paths are matched
i.e. directories are not included in the result list.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">By default all the files matching the specified glob pattern are emitted by the channel as a sole (list) item.
It is also possible to emit each file as a sole item by adding the <tt class="docutils literal"><span class="pre">mode</span> <span class="pre">flatten</span></tt> attribute in the output file
declaration.</p>
</div>
<p>By using the <cite>mode</cite> attribute the previous example can be re-written as show below:</p>
<div class="highlight-python"><pre>process splitLetters {

    output:
    file 'chunk_*' into letters mode flatten

    '''
    printf 'Hola' | split -b 1 - chunk_
    '''
}

letters .subscribe { println "File: ${it.name} =&gt; ${it.text}" }</pre>
</div>
<p>Read more about glob syntax at the following link <a class="reference external" href="http://docs.oracle.com/javase/tutorial/essential/io/fileOps.html#glob">What is a glob?</a></p>
</div>
<div class="section" id="dynamic-output-file-names">
<span id="process-dynoutname"></span><h3>Dynamic output file names<a class="headerlink" href="#dynamic-output-file-names" title="Permalink to this headline">¶</a></h3>
<p>When an output file name needs to be expressed dynamically, it is possible to define it using a dynamic evaluated
string which references values defined in the input declaration block or in the script global context.
For example:</p>
<div class="highlight-python"><pre>process align {
  input:
  val x from species
  file seq from sequences

  output:
  file "${x}.aln" into genomes

  """
  t_coffee -in $seq &gt; ${x}.aln
  """
}</pre>
</div>
<p>In the above example, each time the process is executed an alignment file is produced whose name depends
on the actual value of the <tt class="docutils literal"><span class="pre">x</span></tt> input.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>The management of output files is a very common misunderstanding when using Nextflow.
With other tools, it is generally necessary to organize the outputs files into some kind of directory
structure or to guarantee a unique file name scheme, so that result files won't overwrite each other
and that they can be referenced univocally by downstream tasks.</p>
<p>With Nextflow, in most cases, you don't need to take care of naming output files, because each task is executed
in its own unique temporary directory, so files produced by different tasks can never override each other.
Also meta-data can be associated with outputs by using the <a class="reference internal" href="#process-set"><em>set output</em></a> qualifier, instead of
including them in the output file name.</p>
<p class="last">To sum up, the use of output files with static names over dynamic ones is preferable whenever possible,
because it will result in a simpler and more portable code.</p>
</div>
</div>
<div class="section" id="output-stdout-special-file">
<span id="process-stdout"></span><h3>Output 'stdout' special file<a class="headerlink" href="#output-stdout-special-file" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">stdout</span></tt> qualifier allows to <cite>capture</cite> the <cite>stdout</cite> output of the executed process and send it over
the channel specified in the output parameter declaration. For example:</p>
<div class="highlight-python"><pre>process echoSomething {
    output:
    stdout channel

    "echo Hello world!"

}

channel.subscribe { print "I say..  $it" }</pre>
</div>
</div>
<div class="section" id="output-set-of-values">
<span id="process-set"></span><h3>Output 'set' of values<a class="headerlink" href="#output-set-of-values" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">set</span></tt> qualifier allows to send multiple values into a single channel. This feature is useful
when you need to <cite>together</cite> the result of multiple execution of the same process, as shown in the following
example:</p>
<div class="highlight-python"><pre>query = Channel.fromPath '*.fa'
specie = Channel.from 'human', 'cow', 'horse'

process blast {

input:
    val specie
    file query

output:
    set val(specie), file('result') into blastOuts


"blast -db nr -query $query" &gt; result

}</pre>
</div>
<p>In the above example a <cite>BLAST</cite> task is executed for each pair of <tt class="docutils literal"><span class="pre">specie</span></tt> and <tt class="docutils literal"><span class="pre">query</span></tt> that are received.
When the task completes a new tuple containing the value for <tt class="docutils literal"><span class="pre">specie</span></tt> and the file <tt class="docutils literal"><span class="pre">result</span></tt> is sent to the <tt class="docutils literal"><span class="pre">blastOuts</span></tt> channel.</p>
<p>A <cite>set</cite> declaration can contain any combination of the following qualifiers, previously described: <tt class="docutils literal"><span class="pre">val</span></tt>, <tt class="docutils literal"><span class="pre">file</span></tt> and <tt class="docutils literal"><span class="pre">stdout</span></tt>.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Variable identifiers are interpreted as <cite>values</cite> while strings literals are interpreted as <cite>files</cite> by default,
thus the above output <cite>set</cite> can be rewritten using a short notation as shown below.</p>
</div>
<div class="highlight-python"><pre>output:
    set specie, 'result' into blastOuts</pre>
</div>
<p>File names can be defined in a dynamic manner as explained in the <a class="reference internal" href="#process-dynoutname"><em>Dynamic output file names</em></a> section.</p>
</div>
</div>
<div class="section" id="when">
<h2>When<a class="headerlink" href="#when" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">when</span></tt> declaration allows you to define a condition that must be verified in order to execute the process.
This can be any expression that evaluates a boolean value.</p>
<p>It is useful to enable/disable the process execution depending the state of various inputs and parameters. For example:</p>
<div class="highlight-python"><pre>process find {
  input:
  file proteins
  val type from dbtype

  when:
  proteins.name =~ /^BB11.*/ &amp;&amp; type == 'nr'

  script:
  """
  blastp -query $proteins -db nr
  """

}</pre>
</div>
</div>
<div class="section" id="shares">
<h2>Shares<a class="headerlink" href="#shares" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This feature has been deprecated and will be removed in future releases</p>
</div>
<p>Share declarations are a special type of process parameter that can act as an <cite>input</cite> and <cite>output</cite> parameter at the same time.</p>
<p>The share block is declared by using the syntax shown below:</p>
<div class="highlight-python"><pre>share:
  &lt;share qualifier&gt; &lt;parameter name&gt; [from &lt;source channel&gt;] [into &lt;target channel&gt;] [attributes]</pre>
</div>
<p>A share definition begins with the share <cite>qualifier</cite> followed by the parameter <cite>name</cite>. Optionally the keyword <tt class="docutils literal"><span class="pre">from</span></tt>
can be used to specify the channel over which data is received, and the keyword <tt class="docutils literal"><span class="pre">into</span></tt>, followed by a channel name,
can be used to specify the channel where the produced data has to be sent.</p>
<p>Share parameters accept only the qualifiers listed in the following table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Qualifier</th>
<th class="head">Semantic</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>val</td>
<td>Lets you access the input value in the process script and/or to send it over the output channel.</td>
</tr>
<tr class="row-odd"><td>file</td>
<td>Lets you handle the input value as a file, staging it properly in the execution context and/or send it as result over the output channel.</td>
</tr>
</tbody>
</table>
<p>Share parameters have some important differences compared to input or output parameters:</p>
<ul class="simple">
<li>A share parameter can only receive a single input value, which is bound in the script evaluation context before the process first execution.</li>
<li>If a share parameter declares an output channel it emits exactly one value, after the process last execution.</li>
<li>It allows you to <cite>share</cite> the parameter's value across multiple process executions.</li>
<li>Whenever a share parameter is declared, the process is executed serially, instead of in a parallel manner.</li>
</ul>
<div class="section" id="share-generic-values">
<h3>Share generic values<a class="headerlink" href="#share-generic-values" title="Permalink to this headline">¶</a></h3>
<p>The share <tt class="docutils literal"><span class="pre">val</span></tt> qualifier allows you to declare a parameter whose value can be accessed,
in the script context, across multiple executions of the same process. For example:</p>
<div class="highlight-python"><pre>process printCount {
  input:
  val cheers from 'Bonjour', 'Ciao', 'Hello', 'Hola'

  share:
  val count from 1 into result

  script:
  count += count
  "echo $cheers world! "

}


result.subscribe  { println "Result = $it" }</pre>
</div>
<p>Will output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Result</span> <span class="o">=</span> <span class="mi">16</span>
</pre></div>
</div>
<p>This example shows how the <cite>state</cite> of the <tt class="docutils literal"><span class="pre">count</span></tt> variable is maintained throughout the process executions, and
how on process termination the final value is sent over the channel declared by the <tt class="docutils literal"><span class="pre">into</span></tt> keyword.</p>
<p>Some caveats about shared value parameters:</p>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">from</span></tt> declaration can be used to initialise the parameter by specifying a variable defined in the
pipeline script or by using a <cite>literal</cite> value (as in the above example).</li>
<li>When the <tt class="docutils literal"><span class="pre">from</span></tt> declaration is omitted, the parameter is initialised to the variable's value in the script scope
having the same name as the parameter.</li>
<li>When a variable with the parameter's name doesn't exist in the script scope and no <tt class="docutils literal"><span class="pre">from</span></tt> is specified,
the parameter is initialised to <tt class="docutils literal"><span class="pre">null</span></tt>.</li>
</ul>
</div>
<div class="section" id="share-file">
<h3>Share file<a class="headerlink" href="#share-file" title="Permalink to this headline">¶</a></h3>
<p>The share <tt class="docutils literal"><span class="pre">file</span></tt> qualifier allows you to declare a parameter that shares its state using a file. For example:</p>
<div class="highlight-python"><pre>process saveHello {
    input:
    val cheers from 'Bonjour', 'Ciao', 'Hello', 'Hola'

    share:
    file greetings into result

    "echo '$cheers' &gt;&gt; $greetings "

  }

  result.subscribe { println it.text  }</pre>
</div>
<p>It will print:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Bonjour</span>
<span class="n">Ciao</span>
<span class="n">Hello</span>
<span class="n">Hola</span>
</pre></div>
</div>
<p>This example shows how the file content is shared through the process executions. When the process
completes, the file is sent over the channel declared as output.</p>
</div>
</div>
<div class="section" id="directives">
<span id="process-directives"></span><h2>Directives<a class="headerlink" href="#directives" title="Permalink to this headline">¶</a></h2>
<p>Using the <cite>directive</cite> declarations block you can provide optional settings that will affect the execution of the current
process.</p>
<p>They must be entered at the top of the process <cite>body</cite>, before any other declaration blocks (i.e. <tt class="docutils literal"><span class="pre">input</span></tt>, <tt class="docutils literal"><span class="pre">output</span></tt>, etc)
and have the following syntax:</p>
<div class="highlight-python"><pre>name value [, value2 [,..]]</pre>
</div>
<p>Some directives are generally available to all processes, some others depends on the <cite>executor</cite> currently defined.</p>
<p>The directives are:</p>
<ul class="simple">
<li><a class="reference internal" href="#afterscript">afterScript</a></li>
<li><a class="reference internal" href="#beforescript">beforeScript</a></li>
<li><a class="reference internal" href="#cache">cache</a></li>
<li><a class="reference internal" href="#cpus">cpus</a></li>
<li><a class="reference internal" href="#container">container</a></li>
<li><a class="reference internal" href="#clusteroptions">clusterOptions</a></li>
<li><a class="reference internal" href="#disk">disk</a></li>
<li><a class="reference internal" href="#echo">echo</a></li>
<li><a class="reference internal" href="#errorstrategy">errorStrategy</a></li>
<li><a class="reference internal" href="#executor">executor</a></li>
<li><a class="reference internal" href="#ext">ext</a></li>
<li><a class="reference internal" href="#queue">queue</a></li>
<li><a class="reference internal" href="#maxerrors">maxErrors</a></li>
<li><a class="reference internal" href="#maxforks">maxForks</a></li>
<li><a class="reference internal" href="#maxretries">maxRetries</a></li>
<li><a class="reference internal" href="#memory">memory</a></li>
<li><a class="reference internal" href="#module">module</a></li>
<li><a class="reference internal" href="#penv">penv</a></li>
<li><a class="reference internal" href="#scratch">scratch</a></li>
<li><a class="reference internal" href="#storedir">storeDir</a></li>
<li><a class="reference internal" href="#tag">tag</a></li>
<li><a class="reference internal" href="#time">time</a></li>
<li><a class="reference internal" href="#validexitstatus">validExitStatus</a></li>
</ul>
<div class="section" id="cache">
<h3>cache<a class="headerlink" href="#cache" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">cache</span></tt> directive allows you to store the process results to a local cache. Any following attempt to execute
the process along with the same inputs will cause the process execution to be skipped, producing the stored data as
the actual results.</p>
<p>The caching feature generates a unique <cite>key</cite> by indexing the process script and inputs. This key is used
identify univocally the outputs produced by the process execution.</p>
<p>The cache is enabled by default, you can disable it for a specific process by setting the <tt class="docutils literal"><span class="pre">cache</span></tt>
directive to <tt class="docutils literal"><span class="pre">false</span></tt>. For example:</p>
<div class="highlight-python"><pre>process noCacheThis {
  cache false

  script:
  &lt;your command string here&gt;
}</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">cache</span></tt> directive possible values are shown in the following table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">false</span></tt></td>
<td>Disable cache feature.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">true</span></tt> (default)</td>
<td>Cache process outputs. Input files are indexed by using the meta-data information (name, size and last update timestamp).</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'deep'</span></tt></td>
<td>Cache process outputs. Input files are indexed by their content.</td>
</tr>
</tbody>
</table>
<div class="section" id="container">
<h4>container<a class="headerlink" href="#container" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">container</span></tt> directive allows you to execute the process script in a <a class="reference external" href="http://docker.io">Docker</a> container.</p>
<p>It requires the Docker daemon to be running in machine where the pipeline is executed, i.e. the local machine when using the
<em>local</em> executor or the cluster nodes when the pipeline is deployed through a <em>grid</em> executor.</p>
<p>For example:</p>
<div class="highlight-python"><pre>process runThisInDocker {

  container 'dockerbox:tag'

  """
  &lt;your holy script here&gt;
  """

}</pre>
</div>
<p>Simply replace in the above script <tt class="docutils literal"><span class="pre">dockerbox:tag</span></tt> with the Docker image name you want to use.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">This can be very useful to execute your scripts into a replicable self-contained environment or to deploy your pipeline in the cloud.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This directive is ignore for processes <a class="reference internal" href="#process-native"><em>executed natively</em></a>.</p>
</div>
</div>
</div>
<div class="section" id="echo">
<h3>echo<a class="headerlink" href="#echo" title="Permalink to this headline">¶</a></h3>
<p>By default the <cite>stdout</cite> produced by the commands executed in all processes is ignored.
Setting the <tt class="docutils literal"><span class="pre">echo</span></tt> directive to <tt class="docutils literal"><span class="pre">true</span></tt> you can forward the process <cite>stdout</cite> to the current top
running process <cite>stdout</cite> file, showing it in the shell terminal.</p>
<p>For example:</p>
<div class="highlight-python"><pre>process sayHello {
  echo true

  script:
  "echo Hello"
}</pre>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">Hello</span>
</pre></div>
</div>
<p>Without specifying <tt class="docutils literal"><span class="pre">echo</span> <span class="pre">true</span></tt> you won't see the <tt class="docutils literal"><span class="pre">Hello</span></tt> string printed out when executing the above example.</p>
</div>
<div class="section" id="errorstrategy">
<h3>errorStrategy<a class="headerlink" href="#errorstrategy" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">errorStrategy</span></tt> directive allows you to define how an error condition is managed by the process. By default when
an error status is returned by the executed script, the process stops immediately. This in turn forces the entire pipeline
to terminate.</p>
<p>When setting the <tt class="docutils literal"><span class="pre">errorStrategy</span></tt> directive to <tt class="docutils literal"><span class="pre">ignore</span></tt> the process doesn't stop on an error condition,
it just reports a message notifying you of the error event.</p>
<p>For example:</p>
<div class="highlight-python"><pre>process ignoreAnyError {
   errorStrategy 'ignore'

   script:
   &lt;your command string here&gt;
}</pre>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">By definition a command script fails when it ends with a non-zero exit status. To change this behavior
see <a class="reference internal" href="#validexitstatus">validExitStatus</a>.</p>
</div>
<p>Alternatively, you can specify the <tt class="docutils literal"><span class="pre">retry</span></tt> <cite>error strategy</cite>, which allows you to re-submit for execution a process
returning an error condition. For example:</p>
<div class="highlight-python"><pre>process retryIfFail {
   errorStrategy 'retry'

   script:
   &lt;your command string here&gt;
}</pre>
</div>
<p>The number of times a failing process is re-executed is defined by the <a class="reference internal" href="#maxretries">maxRetries</a> and <a class="reference internal" href="#maxerrors">maxErrors</a> directives.</p>
</div>
<div class="section" id="executor">
<h3>executor<a class="headerlink" href="#executor" title="Permalink to this headline">¶</a></h3>
<p>The <cite>executor</cite> defines the underlying system where processes are executed. By default a process uses the executor
defined globally in the <tt class="docutils literal"><span class="pre">nextflow.config</span></tt> file.</p>
<p>The <tt class="docutils literal"><span class="pre">executor</span></tt> directive allows you to configure what executor has to be used by the process, overriding the default
configuration. The following values can be used:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Executor</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">local</span></tt></td>
<td>The process is executed in the computer where <cite>Nextflow</cite> is launched.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">sge</span></tt></td>
<td>The process is executed using a Sun Grid Engine / <a class="reference external" href="http://gridscheduler.sourceforge.net/">Open Grid Engine</a>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">lsf</span></tt></td>
<td>The process is executed via the <a class="reference external" href="http://en.wikipedia.org/wiki/Platform_LSF">Platform LSF</a> job scheduler.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">slurm</span></tt></td>
<td>The process is executed via the SLURM job scheduler.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">pbs</span></tt></td>
<td>The process is executed via the <a class="reference external" href="http://en.wikipedia.org/wiki/Portable_Batch_System">PBS/Torque</a> job scheduler.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">dnanexus</span></tt></td>
<td>The process is executed into the <a class="reference external" href="http://www.dnanexus.com/">DNAnexus</a> cloud.</td>
</tr>
</tbody>
</table>
<p>The following example shows how to set the process's executor:</p>
<div class="highlight-python"><pre>process doSomething {

   executor 'sge'

   script:
   &lt;your script here&gt;

}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Each executor provides its own set of configuration options that can set be in the <cite>directive</cite> declarations block.
See <a class="reference internal" href="executor.html#executor-page"><em>Executors</em></a> section to read about specific executor directives.</p>
</div>
</div>
<div class="section" id="maxerrors">
<h3>maxErrors<a class="headerlink" href="#maxerrors" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">maxErrors</span></tt> directive allows you to specify the maximum number of times a process can fail when using the <tt class="docutils literal"><span class="pre">Retry</span></tt> <cite>error strategy</cite>.
By default this value is set to <tt class="docutils literal"><span class="pre">3</span></tt>, you can change to a different value as show in the example below:</p>
<div class="highlight-python"><pre>process retryIfFail {
  errorStrategy 'retry'
  maxErrors 5

  """
  echo 'do this as that .. '
  """
}</pre>
</div>
<p>See also: <a class="reference internal" href="#errorstrategy">errorStrategy</a> and <a class="reference internal" href="#maxretries">maxRetries</a>.</p>
</div>
<div class="section" id="maxforks">
<h3>maxForks<a class="headerlink" href="#maxforks" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">maxForks</span></tt> directive allows you to define the maximum number of process instances that can be executed in parallel.
By default this value is equals to the number of CPU cores available minus 1.</p>
<p>If you want to execute a process in a sequential manner, set this directive to one. For example:</p>
<div class="highlight-python"><pre>process doNotParallelizeIt {

   maxForks 1

   '''
   &lt;your script here&gt;
   '''

}</pre>
</div>
</div>
<div class="section" id="maxretries">
<h3>maxRetries<a class="headerlink" href="#maxretries" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">maxRetries</span></tt> directive allows you to define the maximum number of times a process instance can be
re-submitted in case of failure. This value is applied only when using the <tt class="docutils literal"><span class="pre">retry</span></tt> <cite>error strategy</cite>. By default
only one retry is allowed, you can increase this value as shown below:</p>
<div class="highlight-python"><pre>process retryIfFail {
    errorStrategy 'retry'
    maxRetries 3

    """
    echo 'do this as that .. '
    """
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is a subtle but important difference between <tt class="docutils literal"><span class="pre">maxRetries</span></tt> and the <tt class="docutils literal"><span class="pre">maxErrors</span></tt> directive.
The latter defines the total number of errors that are allowed during the process execution (the same process can
launch different execution instances), while the <tt class="docutils literal"><span class="pre">maxRetries</span></tt> defines the maximum number of times the same process
execution can be retried in case of an error.</p>
</div>
<p>See also: <a class="reference internal" href="#errorstrategy">errorStrategy</a> and <a class="reference internal" href="#maxerrors">maxErrors</a>.</p>
</div>
<div class="section" id="module">
<h3>module<a class="headerlink" href="#module" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://modules.sourceforge.net/">Modules</a> is a package manager that allows you to dynamically configure
your execution environment and easily switch between multiple versions of the same software tool.</p>
<p>If it is available in your system you can use it with Nextflow in order to configure the processes execution
environment in your pipeline.</p>
<p>In a process definition you can use the <tt class="docutils literal"><span class="pre">module</span></tt> directive to load a specific module version to be used in the
process execution environment. For example:</p>
<div class="highlight-python"><pre>process basicExample {

  module 'ncbi-blast/2.2.27'

  """
  blastp -query &lt;etc..&gt;
  """
}</pre>
</div>
<p>You can repeat the <tt class="docutils literal"><span class="pre">module</span></tt> directive for each module you need to load. Alternatively multiple modules
can be specified in a single <tt class="docutils literal"><span class="pre">module</span></tt> directive by separating all the module names by using a <tt class="docutils literal"><span class="pre">:</span></tt>
(colon) character as shown below:</p>
<div class="highlight-python"><pre> process manyModules {

   module 'ncbi-blast/2.2.27:t_coffee/10.0:clustalw/2.1'

   """
   blastp -query &lt;etc..&gt;
   """
}</pre>
</div>
</div>
<div class="section" id="scratch">
<h3>scratch<a class="headerlink" href="#scratch" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">scratch</span></tt> directive allows you to execute the process in a temporary folder that is local to the execution node.</p>
<p>This is useful when your pipeline is launched by using a <cite>grid</cite> executor, because it permits to decrease the NFS
overhead by running the pipeline processes in a temporary directory in the local disk of the actual execution node.
Only the files declared as output in the process definition will be copied in the pipeline working area.</p>
<p>In its basic form simply specify <tt class="docutils literal"><span class="pre">true</span></tt> at the directive value, as shown below:</p>
<div class="highlight-python"><pre>process simpleTask {

  scratch true

  output:
  file 'data_out'

  '''
  &lt;task script&gt;
  '''
}</pre>
</div>
<p>By doing this, it tries to execute the script in the directory defined by the variable <tt class="docutils literal"><span class="pre">$TMPDIR</span></tt> in the execution node.
If this variable does not exist, it will create a new temporary directory by using the Linux command <tt class="docutils literal"><span class="pre">mktemp</span></tt>.</p>
<p>A custom environment variable, other than <tt class="docutils literal"><span class="pre">$TMPDIR</span></tt>, can be specified by simply using it as the scratch value, for
example:</p>
<div class="highlight-python"><pre>scratch '$MY_GRID_TMP'</pre>
</div>
<p>Note, it must be wrapped by single quotation characters, otherwise the variable will be evaluated in the
pipeline script context.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The variable must guarantee to provide a unique temporary folder for each process invocation, usually such
a variable is defined by the batch scheduler platform.</p>
</div>
<p>You can also provide a specific folder path as scratch value, for example:</p>
<div class="highlight-python"><pre>scratch '/tmp/my/path'</pre>
</div>
<p>By doing this, a new temporary directory will be created in the specified path each time a process is executed.</p>
<p>Finally, when the <tt class="docutils literal"><span class="pre">ram-disk</span></tt> string is provided as <tt class="docutils literal"><span class="pre">scratch</span></tt> value, the process will be execute in the node
RAM virtual disk.</p>
<p>Summary of allowed values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="92%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">scratch</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>false</td>
<td>Do not use the scratch folder</td>
</tr>
<tr class="row-odd"><td>true</td>
<td>Use the scratch folder defined by <tt class="docutils literal"><span class="pre">$TMPDIR</span></tt> variable, fallback to <tt class="docutils literal"><span class="pre">mktemp</span></tt> if that variable do not exists</td>
</tr>
<tr class="row-even"><td>$&lt;YOUR_VAR&gt;</td>
<td>Use the scratch folder defined by the <tt class="docutils literal"><span class="pre">$&lt;YOUR_VAR&gt;</span></tt> environment variable, or fallback to <tt class="docutils literal"><span class="pre">mktemp</span></tt> if that variable do not exists</td>
</tr>
<tr class="row-odd"><td>/tmp/my</td>
<td>Create a temporary scratch directory in the specified directory</td>
</tr>
<tr class="row-even"><td>ram-disk</td>
<td>Create a temporary scratch directory in the RAM disk</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="storedir">
<h3>storeDir<a class="headerlink" href="#storedir" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">storeDir</span></tt> directive allows you to define a directory that is used as <cite>permanent</cite> cache for your process results.</p>
<p>In more detail, it affects the process execution in two main ways:</p>
<ol class="arabic simple">
<li>The process is executed only if the files declared in the <cite>output</cite> clause do not exists in directory specified by
the <tt class="docutils literal"><span class="pre">storeDir</span></tt> directive. When the files exist the process execution is skipped and these files are used as
the actual process result.</li>
<li>Whenever a process complete successfully the files listed in the <cite>output</cite> declaration block are copied in the directory
specified by the <tt class="docutils literal"><span class="pre">storeDir</span></tt> directive.</li>
</ol>
<p>The following example shows how use the <tt class="docutils literal"><span class="pre">storeDir</span></tt> directive to create a directory containing a BLAST database
for each specie specified by an input parameter:</p>
<div class="highlight-python"><pre>genomes = Channel.fromPath(params.genomes)

process formatBlastDatabases {

  storeDir '/db/genomes'

  input:
  file specie from genomes

  output:
  file "${dbName}.*" into blastDb

  script:
  dbName = specie.baseName
  """
  makeblastdb -dbtype nucl -in ${specie} -out ${dbName}
  """

}</pre>
</div>
</div>
<div class="section" id="validexitstatus">
<h3>validExitStatus<a class="headerlink" href="#validexitstatus" title="Permalink to this headline">¶</a></h3>
<p>A process is terminated when the executed command returns an error exit status. By default any error status
other than <tt class="docutils literal"><span class="pre">0</span></tt> is interpreted as an error condition.</p>
<p>The <tt class="docutils literal"><span class="pre">validExitStatus</span></tt> directive allows you to fine control which error status will represent a successful command execution.
You can specify a single value or multiple values as shown in the following example:</p>
<div class="highlight-python"><pre>process returnOk {
    validExitStatus 0,1,2

     script:
     """
     echo Hello
     exit 1
     """
}</pre>
</div>
<p>In the above example, although the command script ends with a <tt class="docutils literal"><span class="pre">1</span></tt> exit status, the process
will not return an error condition because the value <tt class="docutils literal"><span class="pre">1</span></tt> is declared as a <cite>valid</cite> status in
the <tt class="docutils literal"><span class="pre">validExitStatus</span></tt> directive.</p>
</div>
<div class="section" id="cpus">
<span id="process-cpus"></span><h3>cpus<a class="headerlink" href="#cpus" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">cpus</span></tt> directive allows you to define the number of (logical) CPU required by the process' task.
For example:</p>
<div class="highlight-python"><pre>process big_job {

  cpus 8
  executor 'sge'

  """
  blastp -query input_sequence -num_threads ${task.cpus}
  """
}</pre>
</div>
<p>This directive is required for tasks that execute multi-process or multi-threaded commands/tools and it is meant
to reserve enough CPUs when a pipeline task is executed through a cluster resource manager.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently it is supported only by the following grid based executors:
<a class="reference internal" href="executor.html#sge-executor"><em>SGE</em></a>, <a class="reference internal" href="executor.html#lsf-executor"><em>LSF</em></a>, <a class="reference internal" href="executor.html#slurm-executor"><em>SLURM</em></a>,
<a class="reference internal" href="executor.html#pbs-executor"><em>PBS/Torque</em></a> and <a class="reference internal" href="executor.html#drmaa-executor"><em>DRMAA</em></a>.</p>
</div>
<p>See also: <a class="reference internal" href="#penv">penv</a>, <a class="reference internal" href="#memory">memory</a>, <a class="reference internal" href="#time">time</a>, <a class="reference internal" href="#queue">queue</a>, <a class="reference internal" href="#maxforks">maxForks</a></p>
</div>
<div class="section" id="queue">
<span id="process-queue"></span><h3>queue<a class="headerlink" href="#queue" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">queue</span></tt> directory allows you to set the <cite>queue</cite> where jobs are scheduled when using a grid based executor
in your pipeline. For example:</p>
<div class="highlight-python"><pre>process grid_job {

    queue 'long'
    executor 'sge'

    """
    your task script here
    """
}</pre>
</div>
<p>Multiple queues can be specified by separating their names with a comma for example:</p>
<div class="highlight-python"><pre>process grid_job {

    queue 'short,long,cn-el6'
    executor 'sge'

    """
    your task script here
    """
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This directive is taken in account only by the following executors: <a class="reference internal" href="executor.html#sge-executor"><em>SGE</em></a>,
<a class="reference internal" href="executor.html#lsf-executor"><em>LSF</em></a>, <a class="reference internal" href="executor.html#pbs-executor"><em>PBS/Torque</em></a> and <a class="reference internal" href="executor.html#drmaa-executor"><em>DRMAA</em></a></p>
</div>
</div>
<div class="section" id="disk">
<span id="process-disk"></span><h3>disk<a class="headerlink" href="#disk" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">disk</span></tt> directive allows you to define how much local disk storage the process is allowed to use. For example:</p>
<div class="highlight-python"><pre>process big_job {

    disk '2 GB'
    executor 'cirrus'

    """
    your task script here
    """
}</pre>
</div>
<p>The following memory unit suffix can be used when specifying the disk value:</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Unit</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>B</td>
<td>Bytes</td>
</tr>
<tr class="row-odd"><td>KB</td>
<td>Kilobytes</td>
</tr>
<tr class="row-even"><td>MB</td>
<td>Megabytes</td>
</tr>
<tr class="row-odd"><td>GB</td>
<td>Gigabytes</td>
</tr>
<tr class="row-even"><td>TB</td>
<td>Terabytes</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This directive currently is taken in account only by the <a class="reference internal" href="executor.html#cirrus-executor"><em>Cirrus</em></a> executor.</p>
</div>
<p>See also: <a class="reference internal" href="#cpus">cpus</a>, <a class="reference internal" href="#memory">memory</a> <a class="reference internal" href="#time">time</a>, <a class="reference internal" href="#queue">queue</a></p>
</div>
<div class="section" id="memory">
<span id="process-memory"></span><h3>memory<a class="headerlink" href="#memory" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">memory</span></tt> directive allows you to define how much memory the process is allowed to use. For example:</p>
<div class="highlight-python"><pre>process big_job {

    memory '2 GB'
    executor 'sge'

    """
    your task script here
    """
}</pre>
</div>
<p>The following memory unit suffix can be used when specifying the memory value:</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Unit</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>B</td>
<td>Bytes</td>
</tr>
<tr class="row-odd"><td>KB</td>
<td>Kilobytes</td>
</tr>
<tr class="row-even"><td>MB</td>
<td>Megabytes</td>
</tr>
<tr class="row-odd"><td>GB</td>
<td>Gigabytes</td>
</tr>
<tr class="row-even"><td>TB</td>
<td>Terabytes</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This directive is taken in account only when using one of the following grid based executors:
<a class="reference internal" href="executor.html#sge-executor"><em>SGE</em></a>, <a class="reference internal" href="executor.html#lsf-executor"><em>LSF</em></a>, <a class="reference internal" href="executor.html#slurm-executor"><em>SLURM</em></a>, <a class="reference internal" href="executor.html#pbs-executor"><em>PBS/Torque</em></a>
and <a class="reference internal" href="executor.html#drmaa-executor"><em>DRMAA</em></a></p>
</div>
<p>See also: <a class="reference internal" href="#cpus">cpus</a>, <a class="reference internal" href="#time">time</a>, <a class="reference internal" href="#queue">queue</a></p>
</div>
<div class="section" id="time">
<span id="process-time"></span><h3>time<a class="headerlink" href="#time" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">time</span></tt> directive allows you to define how long a process is allowed to run. For example:</p>
<div class="highlight-python"><pre>process big_job {

    time '1h'

    """
    your task script here
    """
}</pre>
</div>
<p>The following time unit suffix can be used when specifying the duration value:</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Unit</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>s</td>
<td>Seconds</td>
</tr>
<tr class="row-odd"><td>m</td>
<td>Minutes</td>
</tr>
<tr class="row-even"><td>h</td>
<td>Hours</td>
</tr>
<tr class="row-odd"><td>d</td>
<td>Days</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This directive is taken in account only when using one of the following grid based executors:
<a class="reference internal" href="executor.html#sge-executor"><em>SGE</em></a>, <a class="reference internal" href="executor.html#lsf-executor"><em>LSF</em></a>, <a class="reference internal" href="executor.html#slurm-executor"><em>SLURM</em></a>, <a class="reference internal" href="executor.html#pbs-executor"><em>PBS/Torque</em></a>
and <a class="reference internal" href="executor.html#drmaa-executor"><em>DRMAA</em></a></p>
</div>
<p>See also: <a class="reference internal" href="#cpus">cpus</a>, <a class="reference internal" href="#memory">memory</a>, <a class="reference internal" href="#queue">queue</a></p>
</div>
<div class="section" id="penv">
<span id="process-penv"></span><h3>penv<a class="headerlink" href="#penv" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">penv</span></tt> directive  allows you to define the <cite>parallel environment</cite> to be used when submitting a parallel task to the
<a class="reference internal" href="executor.html#sge-executor"><em>SGE</em></a> resource manager. For example:</p>
<div class="highlight-python"><pre>process big_job {

  cpus 4
  penv 'smp'
  executor 'sge'

  """
  blastp -query input_sequence -num_threads ${task.cpus}
  """
}</pre>
</div>
<p>This configuration depends on the parallel environment provided by your grid engine installation. Refer to your
cluster documentation or contact your admin to lean more about this.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This setting is available only for the <a class="reference internal" href="executor.html#sge-executor"><em>SGE grid executor</em></a>.</p>
</div>
<p>See also: <a class="reference internal" href="#cpus">cpus</a>, <a class="reference internal" href="#memory">memory</a>, <a class="reference internal" href="#time">time</a></p>
</div>
<div class="section" id="clusteroptions">
<span id="process-clusteroptions"></span><h3>clusterOptions<a class="headerlink" href="#clusteroptions" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">clusterOptions</span></tt> directive allows to use any <cite>native</cite> configuration option accepted by your cluster submit command.
You can use it to request non-standard resources or use settings that are specific to your cluster and not supported
out of the box by Nextflow.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This directive is taken in account only when using a grid based executor:
<a class="reference internal" href="executor.html#sge-executor"><em>SGE</em></a>, <a class="reference internal" href="executor.html#lsf-executor"><em>LSF</em></a>, <a class="reference internal" href="executor.html#slurm-executor"><em>SLURM</em></a>, <a class="reference internal" href="executor.html#pbs-executor"><em>PBS/Torque</em></a>
and <a class="reference internal" href="executor.html#drmaa-executor"><em>DRMAA</em></a></p>
</div>
</div>
<div class="section" id="tag">
<h3>tag<a class="headerlink" href="#tag" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">tag</span></tt> directive allows you to associate each process executions with a custom label, so that it will be easier
to identify them in the log file or in the trace execution report. For example:</p>
<div class="highlight-python"><pre>process foo {
  tag { code }

  input:
  val code from 'alpha', 'gamma', 'omega'

  """
  echo $code
  """
}</pre>
</div>
<p>The above snippet will print a log similar to the following one, where process names contain the tag value:</p>
<div class="highlight-python"><pre>[6e/28919b] Submitted process &gt; foo (alpha)
[d2/1c6175] Submitted process &gt; foo (gamma)
[1c/3ef220] Submitted process &gt; foo (omega)</pre>
</div>
<p>See also <a class="reference internal" href="tracing.html#trace-report"><em>Trace execution report</em></a></p>
</div>
<div class="section" id="beforescript">
<h3>beforeScript<a class="headerlink" href="#beforescript" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">beforeScript</span></tt> directive allows you to execute a custom (BASH) snippet <em>before</em> the main process script is run.
This may be useful to initialise the underlying cluster environment or for other custom initialisation.</p>
<p>For example:</p>
<div class="highlight-python"><pre>process foo {

  beforeScript 'source /cluster/bin/setup'

  """
  echo bar
  """

}</pre>
</div>
</div>
<div class="section" id="afterscript">
<h3>afterScript<a class="headerlink" href="#afterscript" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">afterScript</span></tt> directive allows you to execute a custom (BASH) snippet immediately <em>after</em> the main process has run.
This may be useful to clean up your staging area.</p>
</div>
<div class="section" id="ext">
<h3>ext<a class="headerlink" href="#ext" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">ext</span></tt> is a special directive used as <em>namespace</em> for user custom configuration properties that can be defined at
process level. This can be useful for advanced configuration options.</p>
</div>
<div class="section" id="dynamic-directives">
<h3>Dynamic directives<a class="headerlink" href="#dynamic-directives" title="Permalink to this headline">¶</a></h3>
<p>A directive can be assigned <em>dynamically</em>, during the process execution, so that its actual value can be evaluated
depending on the value of one, or more, process' input values.</p>
<p>In order to be defined in a dynamic manner the directive's value needs to be expressed by using a <a class="reference internal" href="script.html#script-closure"><em>closure</em></a>
statement, as in the following example:</p>
<div class="highlight-python"><pre>process foo {

  executor 'sge'
  queue { entries &gt; 100 ? 'long' : 'short' }

  input:
  set entries, file(x) from data

  script:
  """
  &lt; your job here &gt;
  """
}</pre>
</div>
<p>In the above example the <a class="reference internal" href="#queue">queue</a> directive is evaluated dynamically, depending on the input value <tt class="docutils literal"><span class="pre">entries</span></tt>. When it is
bigger than 100, jobs will be submitted to the queue <tt class="docutils literal"><span class="pre">long</span></tt>, otherwise the <tt class="docutils literal"><span class="pre">short</span></tt> one will be used.</p>
<p>All directives can be assigned to a dynamic value except the following:</p>
<ul class="simple">
<li><a class="reference internal" href="#executor">executor</a></li>
<li><a class="reference internal" href="#maxforks">maxForks</a></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can retrieve the current value of a dynamic directive in the process script by using the implicit variable <tt class="docutils literal"><span class="pre">task</span></tt>
which holds the directive values defined in the current process.</p>
</div>
<p>For example:</p>
<div class="highlight-python"><pre>process foo {

   queue { entries &gt; 100 ? 'long' : 'short' }

   input:
   set entries, file(x) from data

   script:
   """
   echo Current queue: ${task.queue}
   """
 }</pre>
</div>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="channel.html" class="btn btn-neutral float-right" title="Channels"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="script.html" class="btn btn-neutral" title="Pipeline script"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013, Nextflow authors.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

  
  <script>
  if( window.location.hostname == 'localhost' || window.location.hostname == '127.0.0.1' ) { throw new Error('Skip GA on localhost') };
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-364526-10', 'auto');
  ga('send', 'pageview');
  </script>
</body>
</html>